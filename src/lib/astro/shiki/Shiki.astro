---
import { decode as decodeHtmlEntities } from 'html-entities';
import { getHighlighter } from 'shiki';

interface Props {
  lang: string;
}

const { lang } = Astro.props;

const highlighter = await getHighlighter({ theme: 'github-light' });

let content: string = await Astro.slots.render('default');
content = content.replace(
  /<i class="conum" data-value="\d+"><\/i><b>\((\d+)\)<\/b>/g,
  '\u0D82$1\u0D83'
);
content = decodeHtmlEntities(content);
let output = highlighter.codeToHtml(content, { lang });
output = output.replace(/\u0D82(\d+)\u0D83/g, '<i class="conum" data-value="$1"></i><b>$1</b>');
---

<Fragment set:html={output} />
